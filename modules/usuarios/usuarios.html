
<div class="usuarios-module">
    <!-- Barra de acciones superior -->
    <div class="module-header">
        <div class="module-actions">
            <button id="btn-nuevo-usuario" class="btn-primary">
                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="16"></line>
                    <line x1="8" y1="12" x2="16" y2="12"></line>
                </svg>
                <span>Nuevo Usuario</span>
            </button>
            <div class="search-container">
                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text" id="search-usuarios" placeholder="Buscar usuarios..." class="search-input">
            </div>
        </div>
        <div class="module-filters">
            <select id="filter-rol" class="filter-select">
                <option value="">Todos los roles</option>
                <option value="administrador">Administrador</option>
                <option value="supervisor">Supervisor</option>
                <option value="vendedor">Vendedor</option>
            </select>
            <select id="filter-estado" class="filter-select">
                <option value="">Todos los estados</option>
                <option value="active">Activo</option>
                <option value="inactive">Inactivo</option>
            </select>
        </div>
    </div>

    <!-- Tabla de usuarios -->
    <div class="usuarios-table-container">
        <table class="usuarios-table">
            <thead>
                <tr>
                    <th>
                        <div class="th-content">
                            <svg class="table-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            <span>Usuario</span>
                        </div>
                    </th>
                    <th>
                        <div class="th-content">
                            <svg class="table-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                <polyline points="22,6 12,13 2,6"></polyline>
                            </svg>
                            <span>Email</span>
                        </div>
                    </th>
                    <th>
                        <div class="th-content">
                            <svg class="table-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
                            </svg>
                            <span>Rol</span>
                        </div>
                    </th>
                    <th>
                        <div class="th-content">
                            <svg class="table-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            <span>Estado</span>
                        </div>
                    </th>
                    <th>
                        <div class="th-content">
                            <svg class="table-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <span>Último acceso</span>
                        </div>
                    </th>
                    <th>
                        <div class="th-content">
                            <svg class="table-header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="1"></circle>
                                <circle cx="19" cy="12" r="1"></circle>
                                <circle cx="5" cy="12" r="1"></circle>
                            </svg>
                            <span>Acciones</span>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody id="usuarios-table-body">
                <!-- Los usuarios se cargarán dinámicamente aquí -->
            </tbody>
        </table>
    </div>

    <!-- Modal para crear/editar usuario -->
    <div id="modal-usuario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">
                    <svg class="modal-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span>Nuevo Usuario</span>
                </h3>
                <button id="modal-close" class="modal-close">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="form-usuario">
                    <div class="form-step" id="step-1">
                        <h4>Información Personal</h4>
                        <div class="form-group">
                            <label for="nombre">Nombre completo *</label>
                            <input type="text" id="nombre" name="nombre" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Correo electrónico *</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group" id="password-group">
                            <label for="password">Contraseña <span id="password-required">*</span></label>
                            <input type="password" id="password" name="password" minlength="8">
                            <small id="password-hint">Mínimo 8 caracteres</small>
                        </div>
                        <div class="form-group">
                            <label for="rol">Rol del usuario *</label>
                            <select id="rol" name="rol" required>
                                <option value="">Seleccionar rol</option>
                                <option value="vendedor">Vendedor</option>
                                <option value="supervisor">Supervisor</option>
                                <option value="administrador">Administrador</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-step" id="step-2" style="display: none;">
                        <h4>Permisos de Módulos</h4>
                        <p class="permisos-hint">Selecciona los módulos a los que tendrá acceso este usuario</p>
                        <div class="permisos-grid">
                            <div class="permiso-item">
                                <input type="checkbox" id="perm-ventas" name="permisos" value="ventas">
                                <label for="perm-ventas">
                                    <svg class="permiso-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="9" cy="21" r="1"></circle>
                                        <circle cx="20" cy="21" r="1"></circle>
                                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                                    </svg>
                                    <span>Ventas</span>
                                </label>
                            </div>
                            <div class="permiso-item">
                                <input type="checkbox" id="perm-caja" name="permisos" value="caja">
                                <label for="perm-caja">
                                    <svg class="permiso-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="12" y1="1" x2="12" y2="23"></line>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                    </svg>
                                    <span>Caja</span>
                                </label>
                            </div>
                            <div class="permiso-item">
                                <input type="checkbox" id="perm-inventario" name="permisos" value="inventario">
                                <label for="perm-inventario">
                                    <svg class="permiso-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                    </svg>
                                    <span>Inventario</span>
                                </label>
                            </div>
                            <div class="permiso-item">
                                <input type="checkbox" id="perm-compras" name="permisos" value="compras">
                                <label for="perm-compras">
                                    <svg class="permiso-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                        <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                    <span>Compras</span>
                                </label>
                            </div>
                            <div class="permiso-item">
                                <input type="checkbox" id="perm-clientes" name="permisos" value="clientes">
                                <label for="perm-clientes">
                                    <svg class="permiso-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                    <span>Clientes</span>
                                </label>
                            </div>
                            <div class="permiso-item">
                                <input type="checkbox" id="perm-creditos" name="permisos" value="creditos">
                                <label for="perm-creditos">
                                    <svg class="permiso-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="12" y1="1" x2="12" y2="23"></line>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                        <circle cx="12" cy="12" r="10"></circle>
                                    </svg>
                                    <span>Créditos</span>
                                </label>
                            </div>
                            <div class="permiso-item">
                                <input type="checkbox" id="perm-proveedores" name="permisos" value="proveedores">
                                <label for="perm-proveedores">
                                    <svg class="permiso-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="1" y="3" width="15" height="13"></rect>
                                        <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                                        <circle cx="5.5" cy="18.5" r="2.5"></circle>
                                        <circle cx="18.5" cy="18.5" r="2.5"></circle>
                                    </svg>
                                    <span>Proveedores</span>
                                </label>
                            </div>
                            <div class="permiso-item">
                                <input type="checkbox" id="perm-pagos" name="permisos" value="pagos">
                                <label for="perm-pagos">
                                    <svg class="permiso-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M12 1v22"></path>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                        <polyline points="20 17 22 15 20 13"></polyline>
                                        <polyline points="4 7 2 9 4 11"></polyline>
                                    </svg>
                                    <span>Pagos</span>
                                </label>
                            </div>
                            <div class="permiso-item">
                                <input type="checkbox" id="perm-reportes" name="permisos" value="reportes">
                                <label for="perm-reportes">
                                    <svg class="permiso-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="18" y1="20" x2="18" y2="10"></line>
                                        <line x1="12" y1="20" x2="12" y2="4"></line>
                                        <line x1="6" y1="20" x2="6" y2="14"></line>
                                    </svg>
                                    <span>Reportes</span>
                                </label>
                            </div>
                            <div class="permiso-item">
                                <input type="checkbox" id="perm-usuarios" name="permisos" value="usuarios">
                                <label for="perm-usuarios">
                                    <svg class="permiso-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="9" cy="7" r="4"></circle>
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                    </svg>
                                    <span>Usuarios</span>
                                </label>
                            </div>
                            <div class="permiso-item">
                                <input type="checkbox" id="perm-promociones" name="permisos" value="promociones">
                                <label for="perm-promociones">
                                    <svg class="permiso-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                                        <line x1="7" y1="7" x2="7.01" y2="7"></line>
                                    </svg>
                                    <span>Promociones</span>
                                </label>
                            </div>
                            <div class="permiso-item">
                                <input type="checkbox" id="perm-notas" name="permisos" value="notas">
                                <label for="perm-notas">
                                    <svg class="permiso-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <line x1="10" y1="9" x2="8" y2="9"></line>
                                    </svg>
                                    <span>Notas</span>
                                </label>
                            </div>
                            <div class="permiso-item">
                                <input type="checkbox" id="perm-configuracion" name="permisos" value="configuracion">
                                <label for="perm-configuracion">
                                    <svg class="permiso-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="3"></circle>
                                        <path d="M12 1v6m0 6v6m0-18c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zm0 14c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4z"></path>
                                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14m-2.12-2.12a6 6 0 0 0 0-9.9M4.93 4.93a10 10 0 0 0 0 14.14m2.12-2.12a6 6 0 0 1 0-9.9"></path>
                                    </svg>
                                    <span>Configuración</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-step" id="step-3" style="display: none;">
                        <h4>Permisos Avanzados</h4>
                        <p class="permisos-hint">Configura permisos específicos para cada módulo seleccionado</p>
                        
                        <div id="sub-permisos-container">
                            <div id="sub-permisos-caja" class="sub-permisos-modulo" style="display: none;">
                                <div class="sub-permisos-header">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="1" x2="12" y2="23"></line>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                    </svg>
                                    <span>Caja</span>
                                </div>
                                <div class="sub-permisos-list">
                                    <div class="sub-permiso-item">
                                        <input type="checkbox" id="subperm-caja-historial" name="subPermisos" value="caja.historial" checked>
                                        <label for="subperm-caja-historial">
                                            <span class="sub-permiso-nombre">Ver Historial de Cajas</span>
                                            <span class="sub-permiso-desc">Acceso a la pestaña de historial</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div id="sub-permisos-ventas" class="sub-permisos-modulo" style="display: none;">
                                <div class="sub-permisos-header">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="9" cy="21" r="1"></circle>
                                        <circle cx="20" cy="21" r="1"></circle>
                                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                                    </svg>
                                    <span>Ventas</span>
                                </div>
                                <div class="sub-permisos-list">
                                    <div class="sub-permiso-item">
                                        <input type="checkbox" id="subperm-ventas-cancelar" name="subPermisos" value="ventas.cancelarVenta" checked>
                                        <label for="subperm-ventas-cancelar">
                                            <span class="sub-permiso-nombre">Cancelar Ventas</span>
                                            <span class="sub-permiso-desc">Permite cancelar ventas realizadas</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div id="sub-permisos-inventario" class="sub-permisos-modulo" style="display: none;">
                                <div class="sub-permisos-header">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                    </svg>
                                    <span>Inventario</span>
                                </div>
                                <div class="sub-permisos-list">
                                    <div class="sub-permiso-item">
                                        <input type="checkbox" id="subperm-inventario-simulacion" name="subPermisos" value="inventario.simulacion" checked>
                                        <label for="subperm-inventario-simulacion">
                                            <span class="sub-permiso-nombre">Pestaña Simulación</span>
                                            <span class="sub-permiso-desc">Acceso a simulación de pedidos</span>
                                        </label>
                                    </div>
                                    <div class="sub-permiso-item">
                                        <input type="checkbox" id="subperm-inventario-precios" name="subPermisos" value="inventario.preciosClientes" checked>
                                        <label for="subperm-inventario-precios">
                                            <span class="sub-permiso-nombre">Pestaña Precios Clientes</span>
                                            <span class="sub-permiso-desc">Ver precios especiales por cliente</span>
                                        </label>
                                    </div>
                                    <div class="sub-permiso-item">
                                        <input type="checkbox" id="subperm-inventario-eliminar-masivo" name="subPermisos" value="inventario.eliminarMasivo" checked>
                                        <label for="subperm-inventario-eliminar-masivo">
                                            <span class="sub-permiso-nombre">Eliminación Masiva</span>
                                            <span class="sub-permiso-desc">Permite seleccionar y borrar varios productos</span>
                                        </label>
                                    </div>
                                    <div class="sub-permiso-item">
                                        <input type="checkbox" id="subperm-inventario-nuevo" name="subPermisos" value="inventario.nuevoProducto" checked>
                                        <label for="subperm-inventario-nuevo">
                                            <span class="sub-permiso-nombre">Crear Productos</span>
                                            <span class="sub-permiso-desc">Permite agregar nuevos productos</span>
                                        </label>
                                    </div>
                                    <div class="sub-permiso-item">
                                        <input type="checkbox" id="subperm-inventario-categorias" name="subPermisos" value="inventario.categorias" checked>
                                        <label for="subperm-inventario-categorias">
                                            <span class="sub-permiso-nombre">Gestionar Categorías</span>
                                            <span class="sub-permiso-desc">Crear y editar categorías</span>
                                        </label>
                                    </div>
                                    <div class="sub-permiso-item">
                                        <input type="checkbox" id="subperm-inventario-editar" name="subPermisos" value="inventario.editarProducto" checked>
                                        <label for="subperm-inventario-editar">
                                            <span class="sub-permiso-nombre">Editar Productos</span>
                                            <span class="sub-permiso-desc">Modificar productos existentes</span>
                                        </label>
                                    </div>
                                    <div class="sub-permiso-item">
                                        <input type="checkbox" id="subperm-inventario-eliminar" name="subPermisos" value="inventario.eliminarProducto" checked>
                                        <label for="subperm-inventario-eliminar">
                                            <span class="sub-permiso-nombre">Eliminar Productos</span>
                                            <span class="sub-permiso-desc">Permite eliminar productos</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div id="no-sub-permisos-msg" class="no-sub-permisos">
                                <p>Selecciona módulos con permisos avanzados disponibles (Caja, Ventas o Inventario) en el paso anterior para configurar permisos específicos.</p>
                            </div>
                        </div>
                    </div>

                    <div class="form-navigation">
                        <button type="button" id="btn-anterior" style="display: none;">Anterior</button>
                        <button type="button" id="btn-siguiente">Siguiente</button>
                        <button type="submit" id="btn-guardar" style="display: none;">Guardar Usuario</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Procesando...</p>
        </div>
    </div>
</div>
